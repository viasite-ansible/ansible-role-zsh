---

- name: Install zsh, git, wget
  package:
    name: "{{ item }}"
    state: present
  with_items:
    - zsh
    - git
    - wget
  # brew don't work from root user on macOS
  when: not (zsh_user == 'root' and ansible_os_family == 'Darwin')

- name: "Clone {{ zsh_plugin_manager }} {{ zsh_pm.version }}"
  git:
    repo: "{{ zsh_pm.repo }}"
    dest: "{{ zsh_pm.dest }}"
    version: "{{ zsh_pm.version }}"
    force: yes
  become: yes
  become_user: "{{ zsh_user }}"

- name: Set directory permissions
  file:
    name: "{{ zsh_pm.path }}"
    owner: "{{ zsh_user }}"
    group: "{{ zsh_user_group }}"
    recurse: yes
  changed_when: false

- name: Check fzf installed
  command: which fzf
  changed_when: false
  failed_when: false
  register: zsh_register_fzf_command

- name: Download fzf
  unarchive:
    src: "{{ zsh_fzf_url }}"
    dest: /usr/local/bin
    remote_src: yes
    creates: /usr/local/bin/fzf
  when: zsh_register_fzf_command.rc == 1
